generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
  schemas   = ["cuidapp"]
}

model Location {
  id            String   @id @default(cuid())
  user_id       String   @unique
  label         String?
  address_line1 String?
  address_line2 String?
  district      String?
  canton        String?
  province      String?
  country       String?
  postal_code   String?
  latitude      Float?
  longitude     Float?
  is_primary    Boolean  @default(true)
  created_at    DateTime @default(now())
  updated_at    DateTime @updatedAt
  user          User     @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@map("locations")
  @@schema("cuidapp")
}

model Role {
  id           String   @id @default(cuid())
  code         String   @unique
  display_name String
  created_at   DateTime @default(now())
  updated_at   DateTime @updatedAt
  users        User[]

  @@map("roles")
  @@schema("cuidapp")
}

model Disability {
  id          String   @id @default(cuid())
  name        String   @unique
  description String?
  created_at  DateTime @default(now())
  updated_at  DateTime @updatedAt
  users       User[]

  @@map("disabilities")
  @@schema("cuidapp")
}

model User {
  id               String           @id @default(cuid())
  full_name        String
  username         String           @unique
  email            String           @unique
  password         String
  photo_url        String?
  phone_number     String?
  emergency_number String?
  disability_id    String?
  has_safeguard    Boolean          @default(false)
  notes            String?
  rating           Float?
  rating_count     Int?             @default(0)
  role_id          String
  is_active        Boolean          @default(true)
  created_at       DateTime         @default(now())
  updated_at       DateTime         @updatedAt
  location         Location?
  disability       Disability?      @relation(fields: [disability_id], references: [id])
  role             Role             @relation(fields: [role_id], references: [id])
  assistant_of     UsersAssistant[] @relation("AssistantOf")
  users_assistants UsersAssistant[] @relation("UserAssistants")
  requests         UserRequests[]

  @@map("users")
  @@schema("cuidapp")
}

model UsersAssistant {
  id                          String                     @id @default(cuid())
  user_id                     String
  assistant_id                String
  start_date                  DateTime
  end_date                    DateTime?
  created_at                  DateTime                   @default(now())
  updated_at                  DateTime                   @updatedAt
  assistant                   User                       @relation("AssistantOf", fields: [assistant_id], references: [id], onDelete: Cascade)
  user                        User                       @relation("UserAssistants", fields: [user_id], references: [id], onDelete: Cascade)
  rules                       UsersAssistantsRule[]
  user_assistant_applications UserAssistantApplication[]

  @@map("users_assistants")
  @@schema("cuidapp")
}

model UsersAssistantsRule {
  id                 String         @id @default(cuid())
  users_assistant_id String
  is_primary         Boolean        @default(false)
  created_at         DateTime       @default(now())
  updated_at         DateTime       @updatedAt
  users_assistant    UsersAssistant @relation(fields: [users_assistant_id], references: [id], onDelete: Cascade)

  @@map("users_assistants_rule")
  @@schema("cuidapp")
}

model UserAssistantApplication {
  id                String               @id @default(cuid())
  user_assistant_id String
  description       String?
  status            String
  created_at        DateTime             @default(now())
  updated_at        DateTime             @updatedAt
  user              UsersAssistant       @relation(fields: [user_assistant_id], references: [id], onDelete: Cascade)
  requests          ApplicationRequest[]

  @@map("user_assistant_applications")
  @@schema("cuidapp")
}

model ApplicationRequest {
  id                            String            @id @default(cuid())
  user_assistant_application_id String
  user_request_id               String
  status                        ApplicationStatus @default(PENDING)
  notes                         String?
  created_at                    DateTime          @default(now())
  updated_at                    DateTime          @updatedAt

  user_assistant_application UserAssistantApplication @relation(fields: [user_assistant_application_id], references: [id], onDelete: Cascade)
  user_request               UserRequests             @relation(fields: [user_request_id], references: [id], onDelete: Cascade)

  @@unique([user_assistant_application_id, user_request_id])
  @@map("application_requests")
  @@schema("cuidapp")
}

model UserRequests {
  id           String               @id @default(cuid())
  user_id      String
  description  String
  request_date DateTime
  request_time String
  status       String
  created_at   DateTime             @default(now())
  updated_at   DateTime             @updatedAt
  user         User                 @relation(fields: [user_id], references: [id], onDelete: Cascade)
  applications ApplicationRequest[]

  @@map("user_requests")
  @@schema("cuidapp")
}

enum ApplicationStatus {
  PENDING
  ACCEPTED
  REJECTED

  @@schema("cuidapp")
}
